import{m as we,s as Pe,l as Le,O as _e,h as Ge,i as Ne,j as ve,R as Ee,b as Ce,e as xe,g as Fe,u as Ae}from"./utils.684b27f5.js";import{p as Ue,C as R,d as u,o as Oe,G as De,R as ae,s as A,g as Ie,at as ke,A as se,S as Be,P as je,au as qe,av as $e,F as He,aw as We}from"./vendor.b603f603.js";import{T as ze}from"./TransformControls.75d40bd3.js";import{L as Ve}from"./LGLTracerRenderer.383bc7f1.js";import{D as te}from"./DisneyMaterial.dae81f5f.js";class h extends Ue{constructor(e){super();this.isGLTFSpecularGlossinessMaterial=!0;const s=["#ifdef USE_SPECULARMAP","	uniform sampler2D specularMap;","#endif"].join(`
`),i=["#ifdef USE_GLOSSINESSMAP","	uniform sampler2D glossinessMap;","#endif"].join(`
`),l=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","	vec4 texelSpecular = texture2D( specularMap, vUv );","	// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","	specularFactor = texelSpecular.rgb;","#endif"].join(`
`),t=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","	vec4 texelGlossiness = texture2D( glossinessMap, vUv );","	// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","	glossinessFactor = texelGlossiness.x;","#endif"].join(`
`),r=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join(`
`),o={specular:{value:new R().setHex(0)},glossiness:{value:0},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=o,this.onBeforeCompile=function(c){for(const y in o)c.uniforms[y]=o[y];c.fragmentShader=c.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",s).replace("#include <metalnessmap_pars_fragment>",i).replace("#include <roughnessmap_fragment>",l).replace("#include <metalnessmap_fragment>",t).replace("#include <lights_physical_fragment>",r)},Object.defineProperties(this,{specular:{get:function(){return o.specular.value},set:function(c){o.specular.value=c}},specularMap:{get:function(){return o.specularMap.value},set:function(c){o.specularMap.value=c,c?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return o.glossiness.value},set:function(c){o.glossiness.value=c}},glossinessMap:{get:function(){return o.glossinessMap.value},set:function(c){o.glossinessMap.value=c,c?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}copy(e){return super.copy(e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}async function Xe(a){let e=[];const s=[],i=new De,l=["/models/4dShoe/50/uploads_COLOR.PNG","/models/4dShoe/50/uploads_NORMAL.PNG","/models/4dShoe/50/uploads_SPECULAR.PNG","/models/4dShoe/50/uploads_GLOSS.PNG","/models/4dShoe/47/uploads_SPECULAR.PNG","/models/4dShoe/47/uploads_GLOSS.PNG","/models/4dShoe/8/uploads_COLOR.PNG","/models/4dShoe/8/uploads_NORMAL.PNG","/models/4dShoe/8/uploads_SPECULAR.PNG","/models/4dShoe/8/uploads_GLOSS.PNG","/models/4dShoe/38/uploads_NORMAL.PNG","/models/4dShoe/6/uploads_COLOR.PNG","/models/4dShoe/6/uploads_NORMAL.PNG","/models/4dShoe/6/uploads_SPECULAR.PNG","/models/4dShoe/6/uploads_GLOSS.PNG","/models/4dShoe/10/uploads_COLOR.PNG","/models/4dShoe/10/uploads_NORMAL.PNG","/models/4dShoe/10/uploads_SPECULAR.PNG","/models/4dShoe/10/uploads_GLOSS.PNG","/models/4dShoe/28/uploads_NORMAL.PNG","/models/4dShoe/20/uploads_NORMAL.PNG","/models/4dShoe/34/uploads_COLOR.PNG","/models/4dShoe/34/uploads_NORMAL.PNG","/models/4dShoe/34/uploads_SPECULAR.PNG","/models/4dShoe/34/uploads_GLOSS.PNG","/models/4dShoe/12/uploads_COLOR.PNG","/models/4dShoe/12/uploads_NORMAL.PNG","/models/4dShoe/12/uploads_SPECULAR.PNG","/models/4dShoe/12/uploads_GLOSS.PNG","/models/4dShoe/1/uploads_COLOR.PNG","/models/4dShoe/1/uploads_NORMAL.PNG","/models/4dShoe/9/uploads_COLOR.PNG","/models/4dShoe/9/uploads_NORMAL.PNG","/models/4dShoe/9/uploads_SPECULAR.PNG","/models/4dShoe/9/uploads_GLOSS.PNG"],t=l.length;let r=0;return l.forEach(o=>{s.push(new Promise(c=>{i.load(o,y=>{r++,typeof a=="function"&&a(r/t),c(y)})}))}),await Promise.all(s).then(o=>{e=o}),e}function Ye(a){a.forEach(e=>{e.wrapS=ae,e.wrapT=ae})}function p(a,e,s,i,l){[a.map,a.normalMap,a.specularMap,a.glossinessMap].forEach(r=>{!r||(s&&(r.offset=s),e&&(r.repeat=e),i&&(r.rotation=i),l&&(r.center=l))})}function Je(a){a.forEach(e=>{e.normalScale=new u(1.2),e.map&&(e.map.encoding=A,e.color=new R(1,1,1)),e.specularMap&&(e.specularMap.encoding=A,e.specular=new R(1,1,1)),e.glossinessMap&&(e.glossiness=1),e.emissiveMap&&(e.emissiveMap.encoding=A)})}async function Ke(a){const e=await Xe(a);Ye(e);const s=new h({map:e[0],normalMap:e[1],specularMap:e[2],glossinessMap:e[3]});s.transparent=!0,p(s,new u(.0092,.0092));const i=new h({color:new R(.21960784494876864,0,.3490196168422699),specularMap:e[4],glossinessMap:e[5]});p(i,new u(.011049,.011049));const l=new h({map:e[6],normalMap:e[7],specularMap:e[8]});p(l,new u(.010204,.010204));const t=new h({normalMap:e[10],color:new R(.556,.556,.556),glossiness:.75,specular:new R(.04,.04,.04)});p(t,new u(.019,.019));const r=new h({map:e[11],normalMap:e[12],specularMap:e[13],glossinessMap:e[14]});p(r,new u(.019,.019));const o=new h({map:e[15],normalMap:e[16],specularMap:e[17],glossinessMap:e[18]});p(o,new u(.010941481,.0149168856));const c=new Oe({normalMap:e[19],color:new R(.843137,.847058,.6980392).convertSRGBToLinear(),roughness:0,metalness:1});p(c,new u(.333,.333));const y=new h({normalMap:e[20],color:new R(.556862,.556862,.556862).convertSRGBToLinear(),glossiness:.75,specular:new R(.04,.04,.04)});p(y,new u(.0555,.0555));const _=new h({map:e[21],normalMap:e[22],specularMap:e[23],glossinessMap:e[24]});p(_,new u(.009714324958622456,.02148031443357468));const Z=new h({map:e[25],normalMap:e[26],specularMap:e[27],glossinessMap:e[28]});p(Z,new u(.009728403761982918,.019845079630613327));const q=new h({map:e[29],normalMap:e[30]});q.transparent=!0,p(q,new u(.35714125633239746,.27777722477912903));const $=new h({map:e[31],normalMap:e[32],specularMap:e[33],glossinessMap:e[34]});p($,new u(.01564708352088929,.01406516321003437));const ee=[{material:s,meshName:["50_001"]},{material:i,meshName:["47_001","32_001"]},{material:l,meshName:["8_001","2_001"]},{material:t,meshName:["38_001"]},{material:r,meshName:["6_001"]},{material:o,meshName:["10_001"]},{material:c,meshName:["28_001"]},{material:y,meshName:["20_001"]},{material:_,meshName:["34_001"]},{material:Z,meshName:["12_001"]},{material:q,meshName:["1_001"]},{material:$,meshName:["22_001","13_001","16_001"]},{material:$,meshName:["9_001"]}];return Je(ee.map(Re=>Re.material)),ee}const Qe=[],Ze=xe.LightBooth,ea=Fe.Shoe4D;let U=null,w=!1;const P=document.querySelector("#container"),O=document.querySelector(".loadingText"),aa=document.querySelector(".switchButton"),ne=document.querySelector(".curPipelineText");let f="RayTracing",D=!1,I=!1,k=!1,E=!1,C=!1,ie=null,le=null,H=new Map,W=!1;const z=1,n=new Ve({antialias:!0});let g={bounces:2,envIntensity:z,toneMapping:se,offFocusRender:!0,useTileRender:!0,tileSlicesNum:4,movingDownsampling:!0};function sa(){let a=Ge("lgl_editor_renderer_setting");a&&(g=a)}sa();n.bounces=g.bounces;n.envMapIntensity=g.envIntensity;n.toneMapping=g.toneMapping;n.renderWhenOffFocus=g.offFocusRender;n.useTileRender=g.useTileRender;n.movingDownsampling=g.movingDownsampling;n.tileSlicesNum=g.tileSlicesNum;n.enableTemporalDenoise=!1;n.enableDenoise=!1;document.body.appendChild(n.domElement);n.fullSampleCallback=()=>{W&&(W=!1,be())};const V=!0;let re=!1,G=null,M=null;const{initStats:ta,initGUI:na,initCameraDebugInfo:ia,initNewGUI:la}=we();n.loadingCallback={onProgress:a=>{console.log(a)},onComplete:a=>{if(O.innerText=a,w=!1,L(!1),!re){ra();const{gui:e,params:s,settingFolder:i,denoiseFolder:l}=na(V,n);l.close(),G=e,s.saveSetting=()=>{Object.keys(g).map(t=>{switch(t){case"toneMapping":g[t]=Ie[`${s[t]}ToneMapping`];break;default:g[t]=s[t];break}}),Pe("lgl_editor_renderer_setting",g)},i.add(s,"saveSetting"),G.close()}re=!0,console.log(a)}};const B=ta(V),X=ia(V);let oe=null,j=null;function ra(){n.setDenoiseColorFactor(.05),n.setDenoisePositionFactor(.01)}const S=new ke({canvas:n.domElement,context:n.gl,logarithmicDepthBuffer:!0,premultipliedAlpha:!0});S.toneMapping=se;S.toneMappingExposure=z;S.outputEncoding=A;S.setPixelRatio(1);S.setClearAlpha(0);M=la();M.add({envIntensity:z},"envIntensity",0,5,.5).onChange(a=>{S.toneMappingExposure=a});let N=M.addFolder("Material");M.hide();let T={};const d=new Be;Le(Qe,d);const b=new je(45,window.innerWidth/window.innerHeight,.001,1e3),v=new _e(b,n.domElement);v.screenSpacePanning=!0;const m=new ze(b,n.domElement),Y=new u;let ce=new qe;function de(a){U&&d.remove(U);const e=a.scene;d.add(e),U=e,Ae(b,v,d)}function ue(a){a.mapping=We,d.environment=a,d.background=a}function x(a){C=!0,a.needUpdateRayTracingMaterial=!0}function me(a,e,s,i){Object.keys(e).map(l=>{switch(l){case"color":case"specular":a.addColor(e,l).onChange(t=>{i[`${l}`].set(t),x(s)});break;case"ior":a.add(e,l,1,1.8,.01).onChange(t=>{i[`${l}`]=t,x(s)});break;case"visible":a.add(e,l).onChange(t=>{s.visible=t,E=!0});break;default:a.add(e,l,0,1,.01).onChange(t=>{i[`${l}`]=t,x(s)});break}})}function oa(a){let e=a.material;M.removeFolder(N),N=M.addFolder(`Material: ${e.name}`),N.open(),T={};let s={};T.color=e.color.getHex(),e.isMeshStandardMaterial&&(T.roughness=e.roughness,T.metalness=e.metalness,s.transmission=e.transmission||0,s.ior=e.ior||1.5,s.clearcoat=e.clearcoat||0,s.clearcoatRoughness=e.clearcoatRoughness||0,s.sheen=e.sheen||0,s.sheenTint=e.sheenTint||.5,e.isGLTFSpecularGlossinessMaterial&&(delete T.roughness,delete T.metalness,T.glossiness=e.glossiness,T.specular=e.specular.getHex())),T.opacity=e.opacity,T.visible=a.visible,me(N,T,a,e);let i={},l=N.addFolder(`Texture uvTransform: ${!!e.map}`);if(e.map){const r=e.map;i.offsetX=r.offset.x,i.offsetY=r.offset.y,i.repeatX=r.repeat.x,i.repeatY=r.repeat.y,i.rotation=r.rotation,i.centerX=r.center.x,i.centerY=r.center.y,Object.keys(i).map(o=>{let c,y;switch((o.slice(-1)=="X"||o.slice(-1)=="Y")&&(c=o.slice(-1).toLowerCase(),y=o.slice(0,-1)),o){case"rotation":l.add(i,o,0,Math.PI,.01).onChange(_=>{r.rotation=_,x(a)});break;default:l.add(i,o,0,1,.01).onChange(_=>{r[`${y}`][`${c}`]=_,x(a)});break}}),l.open()}else l.close();let t=N.addFolder(`isMeshPhysicalMaterial: ${!!e.isMeshPhysicalMaterial}`);e.isMeshPhysicalMaterial?(t.open(),me(t,s,a,e)):t.close(),M.show()}function ca(){const a=document.querySelector("#bubble"),e=document.querySelector("#editorBubble");document.querySelector("#bubble-close").onclick=()=>{a.style.display="none"},localStorage.getItem("editorLoadBubble4D")||(a.style.display="block",document.querySelector("#bubble-confirm").onclick=()=>{a.style.display="none",localStorage.setItem("editorLoadBubble4D",!0)}),document.querySelector("#editorBubble-close").onclick=()=>{e.style.display="none"},localStorage.getItem("editorUseBubble4D")||(e.style.display="block",document.querySelector("#editorBubble-confirm").onclick=()=>{e.style.display="none",localStorage.setItem("editorUseBubble4D",!0)})}function pe(a){const e=document.querySelector("#bubble");e.style.display="block",document.querySelector(".bubble-text").innerText=a}function J(a){a?P.classList.contains("isDroping")||P.classList.add("isDroping"):P.classList.contains("isDroping")&&P.classList.remove("isDroping")}function L(a){a?P.classList.contains("isLoading")||P.classList.add("isLoading"):P.classList.contains("isLoading")&&P.classList.remove("isLoading")}function da(){const a=n.domElement;a.addEventListener("dragenter",s=>{J(!0)}),a.addEventListener("dragleave",s=>{J(!1)});const e=new $e(a,a);e.on("drop",({files:s})=>{if(J(!1),w){pe("previous assets no loading complete!");return}w=!0,O.innerText="Building...",L(!0);const i=Array.from(s);i.find(([t,r])=>r.name.match(/\.(gltf|glb)$/))?Ne(s).then(t=>{m.detach(),d.remove(m),de(t),Me(),D=!1,I=!1,k=!1,E=!1,C=!1,f==="RayTracing"?(F("RayTracing"),n.buildScene(d,b).then(()=>{w=!1,D=!0,L(!1)})):(F("RealTime"),M.hide(),I=!0,w=!1,L(!1))}):i.find(([r,o])=>o.name.match(/\.(hdr)$/))?ve(s).then(r=>{ue(r),f==="RayTracing"?(n.updateEnvLight(),n.needsUpdate=!0):k=!0,w=!1,L(!1)}):(w=!1,L(!1),pe("Incorrect resource type(support gltf/glb folder or hdr file)!"))}),e.on("droperror",()=>{console.log("Drop Error")}),ca(),aa.addEventListener("click",s=>{ye(),ne.innerText=f}),n.domElement.addEventListener("dblclick",s=>{if(f!=="RealTime")return;Y.x=s.clientX/window.innerWidth*2-1,Y.y=-(s.clientY/window.innerHeight)*2+1,ce.setFromCamera(Y,b);const i=ce.intersectObjects(U.children);if(i.length){const l=i[0].object;m.attach(l),d.add(m),oa(l)}else d.remove(m),M.hide()}),m.addEventListener("dragging-changed",s=>{f==="RealTime"&&(v.enabled=!s.value,E=!0)}),window.addEventListener("keydown",s=>{if(s.keyCode==81){ye();return}if(f==="RealTime")switch(s.keyCode){case 87:m.setMode("translate");break;case 69:m.setMode("rotate");break;case 82:m.setMode("scale");break;case 32:m.enabled=!m.enabled;break}})}function fe(){if(n.domElement.parentElement){const a=n.domElement.parentElement.clientWidth,e=n.domElement.parentElement.clientHeight;n.setSize(a,e),S&&S.setSize(a,e),b.aspect=a/e,b.updateProjectionMatrix()}}window.addEventListener("resize",fe);fe();async function ua(){const a=new Ee().setDataType(He),e=await new Promise(t=>{a.load(Ze,t)});ue(e);const s=await Ce(ea),i=s.scene;i.rotation.y=-Math.PI/1.8,de(s);const l=await Ke(t=>{O.innerText=`Loading...
		\u6750\u8D28\u8D44\u6E90\u603B\u5927\u5C0F:35Mb ${Number(t*100).toFixed(1)}%`});d.traverse(t=>{t.isMesh&&l.forEach(r=>{const o=r.meshName,c=r.material;if(~o.indexOf(t.name)){c&&(t.material=c);return}})})}function ge(){w=!0,O.innerText="Building...",L(!0),F("RayTracing"),setTimeout(()=>{n.buildScene(d,b).then(()=>{D=!0,K()})},100)}function he(){L(!1),I=!0,Q()}function Me(){H=new Map,d.traverse(a=>{if(a.isMesh&&a.material){let e=H.get(a.material);e===void 0?(a.material.isMeshStandardMaterial?(a.realTimeMaterial=a.material,a.rayTracingMaterial=new te().fromStandardMaterial(a.material)):a.material.isRayTracingMaterial||(a.realTimeMaterial=a.material,a.rayTracingMaterial=new te().fromBasicMaterial(a.material)),H.set(a.material,a.rayTracingMaterial)):(a.realTimeMaterial=a.material,a.rayTracingMaterial=e)}})}function Se(){d.traverse(a=>{a.isMesh&&a.needUpdateRayTracingMaterial&&(a.rayTracingMaterial.fromStandardMaterial(a.realTimeMaterial),a.needUpdateRayTracingMaterial=!1)})}function F(a){d.traverse(e=>{e.isMesh&&(a==="RealTime"?e.material.isRayTracingMaterial&&e.realTimeMaterial&&(e.material=e.realTimeMaterial):!e.material.isRayTracingMaterial&&e.rayTracingMaterial&&(e.material=e.rayTracingMaterial))})}function Te(a){a==="RayTracing"?(G&&G.show(),M&&M.hide()):G&&G.hide()}function ye(){f==="RealTime"?be():W=!0}function be(){cancelAnimationFrame(le),cancelAnimationFrame(ie),f==="RealTime"?(d.remove(m),m.enabled=!1,F("RayTracing"),D?(k&&(n.updateEnvLight(),n.needsUpdate=!0,k=!1),E&&(n.updateMeshTransform(),n.needsUpdate=!0,E=!1),C&&(Se(),n.updateMeshMaterial(),n.needsUpdate=!0,C=!1),K()):(C&&Se(),ge()),Te("RayTracing"),f="RayTracing"):(S.resetState(),F("RealTime"),I?Q():he(),m.enabled=!0,Te("RealTime"),f="RealTime"),v.enabled=!0}function K(a){ie=requestAnimationFrame(K),v.update(),B&&B.begin(),n.render(d,b),B&&B.end(),X&&X.dataBegin&&(j=n.getTotalSamples(),oe!=j&&(X.innerText=`Samples: ${j}`,oe=j))}function Q(){le=requestAnimationFrame(Q),v.update(),S&&S.render(d,b)}async function ma(){await ua(),Me(),f==="RealTime"?he():ge(),da(),ne.innerText=f}ma();
